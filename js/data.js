// 日本の地域階層データ
const japanData = {
    // 北海道
    "北海道": {
        id: "hokkaido",
        regions: {
            "道央地域": {
                cities: {
                    "札幌市": {
                        spots: ["時計台", "大通公園", "札幌テレビ塔", "すすきの"]
                    },
                    "小樽市": {
                        spots: ["小樽運河", "小樽オルゴール堂", "北一硝子"]
                    },
                    "ニセコ町": {
                        spots: ["ニセコマウンテンリゾート", "ニセコアンヌプリ"]
                    }
                }
            },
            "道南地域": {
                cities: {
                    "函館市": {
                        spots: ["函館山", "五稜郭", "元町", "函館朝市"]
                    },
                    "七飯町": {
                        spots: ["大沼国定公園"]
                    }
                }
            },
            "道東地域": {
                cities: {
                    "釧路市": {
                        spots: ["幣舞橋", "釧路湿原", "阿寒湖"]
                    },
                    "網走市": {
                        spots: ["網走監獄博物館", "オホーツク流氷館"]
                    },
                    "知床": {
                        spots: ["知床五湖", "知床峠", "ウトロ温泉"]
                    }
                }
            },
            "道北地域": {
                cities: {
                    "旭川市": {
                        spots: ["旭山動物園", "常磐公園"]
                    },
                    "富良野市": {
                        spots: ["ファーム富田", "富良野スキー場"]
                    },
                    "稚内市": {
                        spots: ["宗谷岬", "ノシャップ岬"]
                    }
                }
            }
        }
    },
    
    // 東北地方
    "青森県": {
        id: "aomori",
        regions: {
            "津軽地域": {
                cities: {
                    "青森市": {
                        spots: ["ねぶた祭り", "三内丸山遺跡"]
                    },
                    "弘前市": {
                        spots: ["弘前城", "弘前公園"]
                    }
                }
            },
            "下北半島": {
                cities: {
                    "むつ市": {
                        spots: ["恐山", "仏ヶ浦"]
                    }
                }
            }
        }
    },
    "岩手県": {
        id: "iwate",
        regions: {
            "盛岡地域": {
                cities: {
                    "盛岡市": {
                        spots: ["岩手公園", "盛岡城跡"]
                    }
                }
            },
            "平泉地域": {
                cities: {
                    "平泉町": {
                        spots: ["中尊寺", "毛越寺"]
                    }
                }
            }
        }
    },
    "宮城県": {
        id: "miyagi",
        regions: {
            "仙台地域": {
                cities: {
                    "仙台市": {
                        spots: ["青葉城址", "瑞鳳殿", "仙台七夕まつり"]
                    }
                }
            },
            "松島地域": {
                cities: {
                    "松島町": {
                        spots: ["松島湾", "瑞巌寺", "五大堂"]
                    }
                }
            }
        }
    },
    "秋田県": {
        id: "akita",
        regions: {
            "秋田市周辺": {
                cities: {
                    "秋田市": {
                        spots: ["竿燈まつり", "千秋公園"]
                    }
                }
            },
            "角館地域": {
                cities: {
                    "仙北市": {
                        spots: ["角館武家屋敷", "桜並木"]
                    }
                }
            }
        }
    },
    "山形県": {
        id: "yamagata",
        regions: {
            "山形市周辺": {
                cities: {
                    "山形市": {
                        spots: ["山寺", "蔵王温泉"]
                    }
                }
            },
            "庄内地域": {
                cities: {
                    "鶴岡市": {
                        spots: ["羽黒山", "出羽三山"]
                    }
                }
            }
        }
    },
    "福島県": {
        id: "fukushima",
        regions: {
            "会津地域": {
                cities: {
                    "会津若松市": {
                        spots: ["鶴ヶ城", "飯盛山"]
                    }
                }
            },
            "福島市周辺": {
                cities: {
                    "福島市": {
                        spots: ["花見山公園", "信夫山"]
                    }
                }
            }
        }
    },
    
    // 関東地方
    "東京都": {
        id: "tokyo",
        regions: {
            "23区": {
                cities: {
                    "千代田区": {
                        spots: ["東京駅", "皇居", "秋葉原"]
                    },
                    "新宿区": {
                        spots: ["新宿御苑", "東京都庁", "歌舞伎町"]
                    },
                    "渋谷区": {
                        spots: ["渋谷スクランブル交差点", "明治神宮", "原宿"]
                    },
                    "台東区": {
                        spots: ["浅草寺", "上野公園", "アメ横"]
                    }
                }
            },
            "多摩地域": {
                cities: {
                    "八王子市": {
                        spots: ["高尾山", "八王子城跡"]
                    },
                    "三鷹市": {
                        spots: ["三鷹の森ジブリ美術館"]
                    }
                }
            },
            "島しょ部": {
                cities: {
                    "大島町": {
                        spots: ["三原山", "波浮港"]
                    },
                    "八丈町": {
                        spots: ["八丈富士", "底土海岸"]
                    }
                }
            }
        }
    },
    "神奈川県": {
        id: "kanagawa",
        regions: {
            "横浜・川崎地域": {
                cities: {
                    "横浜市": {
                        spots: ["みなとみらい", "横浜中華街", "山下公園"]
                    },
                    "川崎市": {
                        spots: ["川崎大師", "藤子・F・不二雄ミュージアム"]
                    }
                }
            },
            "湘南地域": {
                cities: {
                    "鎌倉市": {
                        spots: ["鶴岡八幡宮", "大仏", "江の島"]
                    },
                    "藤沢市": {
                        spots: ["江の島", "湘南海岸"]
                    }
                }
            },
            "箱根地域": {
                cities: {
                    "箱根町": {
                        spots: ["芦ノ湖", "大涌谷", "箱根神社"]
                    }
                }
            }
        }
    },
    
    // 他の都道府県も同様に追加...
    // 中部地方
    "新潟県": {
        id: "niigata",
        regions: {
            "新潟市周辺": {
                cities: {
                    "新潟市": {
                        spots: ["萬代橋", "新潟市水族館", "朱鷺メッセ", "新潟せんべい王国", "白山神社"]
                    }
                }
            },
            "佐渡島": {
                cities: {
                    "佐渡市": {
                        spots: ["佐渡金山", "たらい舟", "トキの森公園", "宿根木", "佐渡歴史伝説館"]
                    }
                }
            },
            "上越地域": {
                cities: {
                    "上越市": {
                        spots: ["高田城", "春日山城跡", "雁木通り", "高田公園"]
                    },
                    "妙高市": {
                        spots: ["妙高山", "赤倉温泉", "いもり池"]
                    }
                }
            }
        }
    },
    "富山県": {
        id: "toyama",
        regions: {
            "富山市周辺": {
                cities: {
                    "富山市": {
                        spots: ["富山城", "富岩運河環水公園", "富山ガラス工房", "富山県美術館", "富山市科学博物館"]
                    }
                }
            },
            "立山黒部": {
                cities: {
                    "立山町": {
                        spots: ["立山黒部アルペンルート", "室堂平", "みくりが池", "大観峰", "黒部ダム"]
                    },
                    "黒部市": {
                        spots: ["宇奈月温泉", "黒部峡谷鉄道", "黒部市歴史民俗資料館"]
                    }
                }
            },
            "高岡地域": {
                cities: {
                    "高岡市": {
                        spots: ["高岡大仏", "瑞龍寺", "高岡古城公園", "高岡銅器団地"]
                    }
                }
            }
        }
    },
    "石川県": {
        id: "ishikawa",
        regions: {
            "金沢地域": {
                cities: {
                    "金沢市": {
                        spots: ["兼六園", "金沢城", "ひがし茶屋街", "近江町市場", "21世紀美術館", "金沢駅鼓門"]
                    }
                }
            },
            "能登地域": {
                cities: {
                    "輪島市": {
                        spots: ["輪島朝市", "白米千枚田", "輪島塗会館"]
                    },
                    "珠洲市": {
                        spots: ["見附島（軍艦島）", "狼煙海岸"]
                    },
                    "七尾市": {
                        spots: ["和倉温泉", "能登島", "七尾城跡"]
                    }
                }
            },
            "加賀地域": {
                cities: {
                    "加賀市": {
                        spots: ["山中温泉", "片山津温泉", "加賀温泉郷"]
                    }
                }
            }
        }
    },
    "福井県": {
        id: "fukui",
        regions: {
            "福井市周辺": {
                cities: {
                    "福井市": {
                        spots: ["一乗谷朝倉氏遺跡", "福井城址", "足羽山公園", "養浩館庭園"]
                    }
                }
            },
            "敦賀・若狭地域": {
                cities: {
                    "敦賀市": {
                        spots: ["気比神宮", "敦賀赤レンガ倉庫", "金崎宮"]
                    },
                    "小浜市": {
                        spots: ["若狭神宮寺", "小浜城跡", "若狭フィッシャーマンズワーフ"]
                    }
                }
            },
            "恐竜博物館エリア": {
                cities: {
                    "勝山市": {
                        spots: ["福井県立恐竜博物館", "スキージャム勝山", "白山平泉寺"]
                    }
                }
            }
        }
    },
    "山梨県": {
        id: "yamanashi",
        regions: {
            "富士山周辺": {
                cities: {
                    "富士吉田市": {
                        spots: ["新倉山浅間公園", "富士山本宮浅間大社", "富士急ハイランド"]
                    },
                    "富士河口湖町": {
                        spots: ["河口湖", "大石公園", "河口浅間神社", "西湖"]
                    }
                }
            },
            "甲府盆地": {
                cities: {
                    "甲府市": {
                        spots: ["甲府城", "武田神社", "昇仙峡"]
                    },
                    "山梨市": {
                        spots: ["フルーツ公園", "西沢渓谷"]
                    }
                }
            }
        }
    },
    "長野県": {
        id: "nagano",
        regions: {
            "長野・善光寺": {
                cities: {
                    "長野市": {
                        spots: ["善光寺", "戸隠神社", "川中島古戦場", "松代城"]
                    }
                }
            },
            "松本・安曇野": {
                cities: {
                    "松本市": {
                        spots: ["松本城", "上高地", "あがたの森公園", "旧開智学校"]
                    },
                    "安曇野市": {
                        spots: ["大王わさび農場", "安曇野ちひろ美術館", "安曇野アートヒルズミュージアム"]
                    }
                }
            },
            "諏訪・八ヶ岳": {
                cities: {
                    "諏訪市": {
                        spots: ["諏訪大社", "諏訪湖", "高島城"]
                    },
                    "茅野市": {
                        spots: ["蓼科高原", "白樺湖", "車山高原"]
                    }
                }
            },
            "軽井沢": {
                cities: {
                    "軽井沢町": {
                        spots: ["軽井沢銀座", "旧軽井沢", "軽井沢プリンスショッピングプラザ", "雲場池"]
                    }
                }
            }
        }
    },
    "岐阜県": {
        id: "gifu",
        regions: {
            "飛騨地域": {
                cities: {
                    "高山市": {
                        spots: ["古い町並", "飛騨高山まつりの森", "高山陣屋", "飛騨の里"]
                    },
                    "白川村": {
                        spots: ["白川郷", "展望台", "和田家"]
                    }
                }
            },
            "下呂・郡上地域": {
                cities: {
                    "下呂市": {
                        spots: ["下呂温泉", "下呂温泉合掌村", "飛騨小坂の滝めぐり"]
                    },
                    "郡上市": {
                        spots: ["郡上八幡城", "郡上八幡博覧館", "長良川"]
                    }
                }
            },
            "岐阜市周辺": {
                cities: {
                    "岐阜市": {
                        spots: ["岐阜城", "長良川鵜飼", "金華山", "岐阜公園"]
                    }
                }
            }
        }
    },
    "静岡県": {
        id: "shizuoka",
        regions: {
            "伊豆半島": {
                cities: {
                    "熱海市": {
                        spots: ["熱海温泉", "熱海海上花火大会", "MOA美術館", "熱海ビーチ"]
                    },
                    "伊東市": {
                        spots: ["伊東温泉", "城ヶ崎海岸", "伊豆シャボテン動物公園"]
                    },
                    "下田市": {
                        spots: ["下田海中水族館", "ペリーロード", "白浜海岸"]
                    }
                }
            },
            "富士山周辺": {
                cities: {
                    "富士宮市": {
                        spots: ["富士山本宮浅間大社", "白糸の滝", "田貫湖"]
                    },
                    "御殿場市": {
                        spots: ["御殿場プレミアム・アウトレット", "富士山樹空の森", "平和公園"]
                    }
                }
            },
            "浜松・浜名湖": {
                cities: {
                    "浜松市": {
                        spots: ["浜松城", "浜名湖", "浜松市楽器博物館", "浜松フラワーパーク"]
                    },
                    "湖西市": {
                        spots: ["新居関所", "浜名湖ガーデンパーク", "浜名湖パルパル"]
                    }
                }
            }
        }
    },
    "愛知県": {
        id: "aichi",
        regions: {
            "名古屋市": {
                cities: {
                    "名古屋市": {
                        spots: ["名古屋城", "熱田神宮", "名古屋港水族館", "東山動植物園", "オアシス21", "名古屋テレビ塔"]
                    }
                }
            },
            "知多・三河地域": {
                cities: {
                    "豊田市": {
                        spots: ["トヨタ産業技術記念館", "香嵐渓", "猿投温泉"]
                    },
                    "岡崎市": {
                        spots: ["岡崎城", "八丁味噌の郷", "岡崎公園"]
                    },
                    "常滑市": {
                        spots: ["セントレア（中部国際空港）", "INAXライブミュージアム", "常滑焼"]
                    }
                }
            },
            "犬山・小牧地域": {
                cities: {
                    "犬山市": {
                        spots: ["犬山城", "明治村", "日本モンキーパーク"]
                    }
                }
            }
        }
    },
    "三重県": {
        id: "mie",
        regions: {
            "伊勢志摩": {
                cities: {
                    "伊勢市": {
                        spots: ["伊勢神宮", "おかげ横丁", "二見興玉神社", "伊勢シーパラダイス"]
                    },
                    "志摩市": {
                        spots: ["志摩スペイン村", "横山展望台", "志摩マリンランド"]
                    },
                    "鳥羽市": {
                        spots: ["鳥羽水族館", "ミキモト真珠島", "鳥羽湾めぐり観光船"]
                    }
                }
            },
            "伊賀・名張": {
                cities: {
                    "伊賀市": {
                        spots: ["伊賀上野城", "伊賀流忍者博物館", "だんじり会館"]
                    },
                    "名張市": {
                        spots: ["赤目四十八滝", "青蓮寺湖", "名張市郷土資料館"]
                    }
                }
            },
            "熊野・尾鷲": {
                cities: {
                    "熊野市": {
                        spots: ["熊野古道", "鬼ヶ城", "花の窟神社"]
                    }
                }
            }
        }
    },
    
    // 近畿地方
    "京都府": {
        id: "kyoto",
        regions: {
            "京都市": {
                cities: {
                    "北区": {
                        spots: ["金閣寺", "北野天満宮", "上賀茂神社", "大徳寺", "鷹峯"]
                    },
                    "東山区": {
                        spots: ["清水寺", "八坂神社", "祇園", "知恩院", "円山公園", "高台寺", "建仁寺", "三十三間堂"]
                    },
                    "右京区": {
                        spots: ["嵐山", "渡月橋", "竜安寺", "仁和寺", "嵯峨野竹林", "天龍寺", "トロッコ列車"]
                    },
                    "上京区": {
                        spots: ["京都御所", "二条城", "晴明神社", "西陣織会館"]
                    },
                    "左京区": {
                        spots: ["銀閣寺", "哲学の道", "南禅寺", "京都大学", "比叡山延暦寺", "鞍馬寺"]
                    },
                    "中京区": {
                        spots: ["錦市場", "京都国際マンガミュージアム", "六角堂", "新京極通"]
                    },
                    "下京区": {
                        spots: ["京都タワー", "東本願寺", "西本願寺", "京都駅ビル"]
                    },
                    "伏見区": {
                        spots: ["伏見稲荷大社", "伏見桃山城", "月桂冠大倉記念館", "寺田屋"]
                    }
                }
            },
            "丹後地域": {
                cities: {
                    "宮津市": {
                        spots: ["天橋立", "智恩寺", "宮津城跡", "天橋立ビューランド"]
                    },
                    "京丹後市": {
                        spots: ["夕日ヶ浦海岸", "琴引浜", "間人カニ", "丹後松島"]
                    }
                }
            },
            "南部地域": {
                cities: {
                    "宇治市": {
                        spots: ["平等院", "宇治上神社", "宇治川", "萬福寺"]
                    },
                    "城陽市": {
                        spots: ["青谷梅林", "久津川車塚古墳"]
                    }
                }
            }
        }
    },
    "大阪府": {
        id: "osaka",
        regions: {
            "大阪市": {
                cities: {
                    "中央区": {
                        spots: ["大阪城", "道頓堀", "心斎橋", "なんばグランド花月", "大阪天満宮", "大阪市中央公会堂"]
                    },
                    "浪速区": {
                        spots: ["通天閣", "新世界", "スパワールド", "ジャンジャン横丁"]
                    },
                    "北区": {
                        spots: ["梅田スカイビル", "グランフロント大阪", "中之島", "大阪駅"]
                    },
                    "天王寺区": {
                        spots: ["天王寺公園", "あべのハルカス", "四天王寺", "新世界"]
                    },
                    "港区": {
                        spots: ["海遊館", "天保山大観覧車", "天保山ハーバービレッジ"]
                    }
                }
            },
            "泉州地域": {
                cities: {
                    "堺市": {
                        spots: ["仁徳天皇陵", "堺旧港", "堺市博物館", "大仙公園", "堺刃物ミュージアム"]
                    },
                    "岸和田市": {
                        spots: ["岸和田城", "だんじり会館", "岸和田だんじり祭り"]
                    }
                }
            },
            "北摂地域": {
                cities: {
                    "豊中市": {
                        spots: ["服部緑地", "大阪国際空港（伊丹空港）", "千里中央公園"]
                    },
                    "高槻市": {
                        spots: ["摂津峡公園", "高槻城跡", "今城塚古墳"]
                    }
                }
            }
        }
    },
    "兵庫県": {
        id: "hyogo",
        regions: {
            "神戸市": {
                cities: {
                    "中央区": {
                        spots: ["神戸港", "神戸ハーバーランド", "南京町", "北野異人館街", "メリケンパーク", "神戸市立博物館"]
                    },
                    "灘区": {
                        spots: ["六甲山", "六甲ガーデンテラス", "灘の酒蔵"]
                    },
                    "須磨区": {
                        spots: ["須磨海浜公園", "須磨寺", "須磨海岸"]
                    }
                }
            },
            "姫路・西播磨": {
                cities: {
                    "姫路市": {
                        spots: ["姫路城", "好古園", "姫路セントラルパーク", "書写山圓教寺"]
                    },
                    "赤穂市": {
                        spots: ["赤穂城跡", "大石神社", "赤穂御崎"]
                    }
                }
            },
            "淡路島": {
                cities: {
                    "淡路市": {
                        spots: ["淡路夢舞台", "あわじ花さじき", "北淡震災記念公園"]
                    },
                    "南あわじ市": {
                        spots: ["鳴門の渦潮", "淡路人形浄瑠璃", "淡路ファームパーク"]
                    }
                }
            },
            "但馬地域": {
                cities: {
                    "豊岡市": {
                        spots: ["城崎温泉", "玄武洞", "コウノトリの郷公園"]
                    },
                    "香美町": {
                        spots: ["余部鉄橋", "但馬牛博物館", "香住海岸"]
                    }
                }
            }
        }
    },
    "奈良県": {
        id: "nara",
        regions: {
            "奈良市周辺": {
                cities: {
                    "奈良市": {
                        spots: ["東大寺", "春日大社", "奈良公園", "興福寺", "正倉院", "平城宮跡", "若草山"]
                    }
                }
            },
            "斑鳩・生駒": {
                cities: {
                    "斑鳩町": {
                        spots: ["法隆寺", "法起寺", "中宮寺"]
                    },
                    "生駒市": {
                        spots: ["生駒山", "宝山寺", "生駒ケーブル"]
                    }
                }
            },
            "飛鳥・橿原": {
                cities: {
                    "明日香村": {
                        spots: ["石舞台古墳", "飛鳥寺", "高松塚古墳", "キトラ古墳"]
                    },
                    "橿原市": {
                        spots: ["橿原神宮", "藤原京跡", "今井町"]
                    }
                }
            },
            "吉野地域": {
                cities: {
                    "吉野町": {
                        spots: ["吉野山", "金峯山寺", "吉水神社"]
                    }
                }
            }
        }
    },
    "滋賀県": {
        id: "shiga",
        regions: {
            "大津市周辺": {
                cities: {
                    "大津市": {
                        spots: ["比叡山延暦寺", "琵琶湖", "三井寺", "石山寺", "大津港"]
                    }
                }
            },
            "彦根・長浜": {
                cities: {
                    "彦根市": {
                        spots: ["彦根城", "玄宮園", "夢京橋キャッスルロード"]
                    },
                    "長浜市": {
                        spots: ["黒壁スクエア", "長浜城", "竹生島"]
                    }
                }
            },
            "近江八幡・東近江": {
                cities: {
                    "近江八幡市": {
                        spots: ["八幡堀", "安土城跡", "沖島"]
                    },
                    "東近江市": {
                        spots: ["永源寺", "百済寺", "太郎坊宮"]
                    }
                }
            }
        }
    },
    "和歌山県": {
        id: "wakayama",
        regions: {
            "和歌山市周辺": {
                cities: {
                    "和歌山市": {
                        spots: ["和歌山城", "紀三井寺", "和歌山マリーナシティ", "和歌山県立博物館"]
                    }
                }
            },
            "白浜・田辺": {
                cities: {
                    "白浜町": {
                        spots: ["白良浜", "アドベンチャーワールド", "円月島", "崎の湯"]
                    },
                    "田辺市": {
                        spots: ["熊野本宮大社", "闘鶏神社", "天神崎"]
                    }
                }
            },
            "高野山": {
                cities: {
                    "高野町": {
                        spots: ["金剛峯寺", "奥の院", "壇上伽藍", "高野山霊宝館"]
                    }
                }
            },
            "熊野地域": {
                cities: {
                    "那智勝浦町": {
                        spots: ["那智の滝", "熊野那智大社", "勝浦温泉"]
                    },
                    "新宮市": {
                        spots: ["熊野速玉大社", "神倉神社", "瀞峡"]
                    }
                }
            }
        }
    },
    
    // 中国・四国地方
    "鳥取県": {
        id: "tottori",
        regions: {
            "鳥取市周辺": {
                cities: {
                    "鳥取市": {
                        spots: ["鳥取砂丘", "砂の美術館", "鳥取城跡", "わらべ館", "因幡万葉歴史館"]
                    }
                }
            },
            "倉吉・三朝": {
                cities: {
                    "倉吉市": {
                        spots: ["赤瓦", "打吹公園", "倉吉白壁土蔵群"]
                    },
                    "三朝町": {
                        spots: ["三朝温泉", "三徳山三佛寺", "三朝ラジウム温泉"]
                    }
                }
            },
            "米子・大山": {
                cities: {
                    "米子市": {
                        spots: ["米子城跡", "皆生温泉", "水鳥公園"]
                    },
                    "大山町": {
                        spots: ["大山", "大山寺", "博労座"]
                    }
                }
            }
        }
    },
    "島根県": {
        id: "shimane",
        regions: {
            "松江・安来": {
                cities: {
                    "松江市": {
                        spots: ["松江城", "宍道湖", "堀川遊覧", "小泉八雲記念館", "松江フォーゲルパーク"]
                    },
                    "安来市": {
                        spots: ["足立美術館", "清水寺", "安来節演芸館"]
                    }
                }
            },
            "出雲地域": {
                cities: {
                    "出雲市": {
                        spots: ["出雲大社", "日御碕灯台", "稲佐の浜", "出雲科学館"]
                    }
                }
            }
        }
    },
    "岡山県": {
        id: "okayama",
        regions: {
            "岡山市周辺": {
                cities: {
                    "岡山市": {
                        spots: ["岡山城", "後楽園", "岡山県立美術館", "吉備津神社"]
                    },
                    "倉敷市": {
                        spots: ["美観地区", "大原美術館", "倉敷アイビースクエア", "瀬戸大橋"]
                    }
                }
            },
            "津山・蒜山": {
                cities: {
                    "津山市": {
                        spots: ["津山城（鶴山公園）", "衆楽園", "津山まなびの鉄道館"]
                    },
                    "真庭市": {
                        spots: ["蒜山高原", "蒜山ジャージーランド", "湯原温泉"]
                    }
                }
            }
        }
    },
    "広島県": {
        id: "hiroshima",
        regions: {
            "広島市周辺": {
                cities: {
                    "広島市": {
                        spots: ["原爆ドーム", "平和記念公園", "広島城", "縮景園", "広島平和記念資料館", "広島市現代美術館"]
                    }
                }
            },
            "宮島地域": {
                cities: {
                    "廿日市市": {
                        spots: ["厳島神社", "宮島", "大鳥居", "弥山", "宮島水族館", "紅葉谷公園"]
                    }
                }
            },
            "尾道・福山": {
                cities: {
                    "尾道市": {
                        spots: ["千光寺", "尾道水道", "尾道商店街", "猫の細道"]
                    },
                    "福山市": {
                        spots: ["福山城", "鞆の浦", "明王院"]
                    }
                }
            }
        }
    },
    "山口県": {
        id: "yamaguchi",
        regions: {
            "下関・宇部": {
                cities: {
                    "下関市": {
                        spots: ["海峡ゆめタワー", "角島大橋", "唐戸市場", "赤間神宮"]
                    },
                    "宇部市": {
                        spots: ["ときわ公園", "ときわ動物園", "ときわミュージアム"]
                    }
                }
            },
            "萩・津和野": {
                cities: {
                    "萩市": {
                        spots: ["萩城跡", "松下村塾", "萩反射炉", "東光寺"]
                    },
                    "長門市": {
                        spots: ["元乃隅神社", "角島", "千畳敷", "青海島"]
                    }
                }
            }
        }
    },
    "徳島県": {
        id: "tokushima",
        regions: {
            "徳島市周辺": {
                cities: {
                    "徳島市": {
                        spots: ["阿波おどり会館", "眉山", "徳島城博物館", "徳島中央公園"]
                    }
                }
            },
            "鳴門・大塚": {
                cities: {
                    "鳴門市": {
                        spots: ["鳴門の渦潮", "大塚国際美術館", "渦の道", "ドイツ館"]
                    }
                }
            },
            "祖谷渓": {
                cities: {
                    "三好市": {
                        spots: ["祖谷のかずら橋", "大歩危小歩危", "祖谷渓", "琵琶の滝"]
                    }
                }
            }
        }
    },
    "香川県": {
        id: "kagawa",
        regions: {
            "高松市周辺": {
                cities: {
                    "高松市": {
                        spots: ["栗林公園", "高松城跡", "玉藻公園", "サンポート高松", "屋島"]
                    }
                }
            },
            "小豆島": {
                cities: {
                    "小豆島町": {
                        spots: ["エンジェルロード", "オリーブ公園", "寒霞渓", "二十四の瞳映画村"]
                    },
                    "土庄町": {
                        spots: ["銚子渓", "小豆島オリーブ園", "土渕海峡"]
                    }
                }
            },
            "琴平・丸亀": {
                cities: {
                    "琴平町": {
                        spots: ["金刀比羅宮", "旧金毘羅大芝居", "琴平温泉"]
                    },
                    "丸亀市": {
                        spots: ["丸亀城", "猪熊弦一郎現代美術館", "丸亀うちわ"]
                    }
                }
            }
        }
    },
    "愛媛県": {
        id: "ehime",
        regions: {
            "松山市周辺": {
                cities: {
                    "松山市": {
                        spots: ["松山城", "道後温泉", "坂の上の雲ミュージアム", "石手寺", "松山市立子規記念博物館"]
                    }
                }
            },
            "今治・しまなみ海道": {
                cities: {
                    "今治市": {
                        spots: ["今治城", "タオル美術館", "しまなみ海道", "大山祇神社"]
                    }
                }
            },
            "宇和島・南予": {
                cities: {
                    "宇和島市": {
                        spots: ["宇和島城", "天赦園", "闘牛"]
                    },
                    "西予市": {
                        spots: ["卯之町の町並み", "明浜町", "四国カルスト"]
                    }
                }
            }
        }
    },
    "高知県": {
        id: "kochi",
        regions: {
            "高知市周辺": {
                cities: {
                    "高知市": {
                        spots: ["高知城", "桂浜", "高知市立龍馬の生まれたまち記念館", "はりまや橋", "日曜市"]
                    }
                }
            },
            "四万十・足摺": {
                cities: {
                    "四万十市": {
                        spots: ["四万十川", "沈下橋", "四万十川学遊館"]
                    },
                    "土佐清水市": {
                        spots: ["足摺岬", "足摺海底館", "竜串海岸"]
                    }
                }
            },
            "室戸・安芸": {
                cities: {
                    "室戸市": {
                        spots: ["室戸岬", "室戸世界ジオパークセンター", "むろと廃校水族館"]
                    },
                    "安芸市": {
                        spots: ["岩崎弥太郎生家", "安芸市立歴史民俗資料館"]
                    }
                }
            }
        }
    },
    
    // 九州・沖縄地方
    "福岡県": {
        id: "fukuoka",
        regions: {
            "福岡市周辺": {
                cities: {
                    "福岡市": {
                        spots: ["太宰府天満宮", "福岡タワー", "博多", "キャナルシティ博多", "マリンワールド海の中道", "福岡城跡", "大濠公園"]
                    },
                    "太宰府市": {
                        spots: ["太宰府天満宮", "九州国立博物館", "観世音寺", "大宰府政庁跡"]
                    }
                }
            },
            "北九州地域": {
                cities: {
                    "北九州市": {
                        spots: ["門司港レトロ", "小倉城", "旦過市場", "皿倉山", "スペースワールド跡地", "到津の森公園"]
                    }
                }
            },
            "久留米・柳川": {
                cities: {
                    "久留米市": {
                        spots: ["久留米城跡", "石橋文化センター", "久留米市美術館"]
                    },
                    "柳川市": {
                        spots: ["柳川川下り", "御花", "立花氏庭園", "沖端水天宮"]
                    }
                }
            }
        }
    },
    "佐賀県": {
        id: "saga",
        regions: {
            "佐賀市周辺": {
                cities: {
                    "佐賀市": {
                        spots: ["佐賀城本丸歴史館", "佐賀バルーンミュージアム", "吉野ヶ里歴史公園"]
                    }
                }
            },
            "唐津・呼子": {
                cities: {
                    "唐津市": {
                        spots: ["唐津城", "虹の松原", "七ツ釜", "唐津くんち"]
                    },
                    "呼子町": {
                        spots: ["呼子の朝市", "七ツ釜", "呼子イカ"]
                    }
                }
            },
            "嬉野・武雄": {
                cities: {
                    "嬉野市": {
                        spots: ["嬉野温泉", "シーボルトの湯"]
                    },
                    "武雄市": {
                        spots: ["武雄温泉", "武雄市図書館", "御船山楽園"]
                    }
                }
            }
        }
    },
    "長崎県": {
        id: "nagasaki",
        regions: {
            "長崎市周辺": {
                cities: {
                    "長崎市": {
                        spots: ["グラバー園", "長崎原爆資料館", "平和公園", "出島", "稲佐山", "長崎ランタンフェスティバル", "大浦天主堂"]
                    }
                }
            },
            "ハウステンボス・佐世保": {
                cities: {
                    "佐世保市": {
                        spots: ["ハウステンボス", "九十九島", "西海国立公園", "佐世保バーガー"]
                    }
                }
            },
            "島原・雲仙": {
                cities: {
                    "島原市": {
                        spots: ["島原城", "武家屋敷", "島原キリシタン館"]
                    },
                    "雲仙市": {
                        spots: ["雲仙地獄", "雲仙温泉", "雲仙岳"]
                    }
                }
            },
            "五島列島": {
                cities: {
                    "五島市": {
                        spots: ["大瀬崎断崖", "鬼岳", "堂崎天主堂", "水ノ浦教会"]
                    }
                }
            }
        }
    },
    "熊本県": {
        id: "kumamoto",
        regions: {
            "熊本市周辺": {
                cities: {
                    "熊本市": {
                        spots: ["熊本城", "水前寺成趣園", "熊本市動植物園", "熊本県立美術館", "くまモンスクエア"]
                    }
                }
            },
            "阿蘇": {
                cities: {
                    "阿蘇市": {
                        spots: ["阿蘇山", "草千里ヶ浜", "阿蘇神社", "阿蘇ファームランド"]
                    }
                }
            },
            "天草": {
                cities: {
                    "天草市": {
                        spots: ["﨑津教会", "天草五橋", "イルカウォッチング", "天草四郎ミュージアム"]
                    }
                }
            }
        }
    },
    "大分県": {
        id: "oita",
        regions: {
            "別府・湯布院": {
                cities: {
                    "別府市": {
                        spots: ["別府地獄めぐり", "別府温泉", "高崎山自然動物園", "別府ロープウェイ"]
                    },
                    "由布市": {
                        spots: ["湯布院温泉", "金鱗湖", "由布院駅", "湯の坪街道"]
                    }
                }
            },
            "大分市周辺": {
                cities: {
                    "大分市": {
                        spots: ["高崎山自然動物園", "大分マリーンパレス水族館「うみたまご」", "大分城址公園"]
                    }
                }
            },
            "国東半島": {
                cities: {
                    "国東市": {
                        spots: ["文殊仙寺", "両子寺", "富貴寺"]
                    }
                }
            }
        }
    },
    "宮崎県": {
        id: "miyazaki",
        regions: {
            "宮崎市周辺": {
                cities: {
                    "宮崎市": {
                        spots: ["青島", "宮崎神宮", "フェニックス自然動物園", "堀切峠"]
                    }
                }
            },
            "日南・鵜戸": {
                cities: {
                    "日南市": {
                        spots: ["鵜戸神宮", "日南海岸", "飫肥城", "モアイ像"]
                    }
                }
            },
            "高千穂": {
                cities: {
                    "高千穂町": {
                        spots: ["高千穂峡", "天岩戸神社", "高千穂神社", "高千穂の夜神楽"]
                    }
                }
            }
        }
    },
    "鹿児島県": {
        id: "kagoshima",
        regions: {
            "鹿児島市周辺": {
                cities: {
                    "鹿児島市": {
                        spots: ["桜島", "城山展望台", "仙巌園", "鹿児島水族館", "維新ふるさと館"]
                    }
                }
            },
            "霧島・指宿": {
                cities: {
                    "霧島市": {
                        spots: ["霧島神宮", "霧島温泉郷", "高千穂峰"]
                    },
                    "指宿市": {
                        spots: ["砂蒸し温泉", "開聞岳", "池田湖", "長崎鼻"]
                    }
                }
            },
            "種子島・屋久島": {
                cities: {
                    "屋久島町": {
                        spots: ["縄文杉", "白谷雲水峡", "ヤクスギランド", "千尋の滝"]
                    },
                    "西之表市": {
                        spots: ["種子島宇宙センター", "鉄砲館", "浦田海水浴場"]
                    }
                }
            }
        }
    },
    "沖縄県": {
        id: "okinawa",
        regions: {
            "那覇市周辺": {
                cities: {
                    "那覇市": {
                        spots: ["首里城", "国際通り", "守礼門", "波上宮", "沖縄県立博物館・美術館", "識名園", "那覇市第一牧志公設市場"]
                    },
                    "浦添市": {
                        spots: ["浦添城跡", "浦添大公園", "港川外人住宅"]
                    }
                }
            },
            "本島北部": {
                cities: {
                    "名護市": {
                        spots: ["美ら海水族館", "古宇利島", "ブセナ海中公園", "万座毛", "ナゴパイナップルパーク"]
                    },
                    "本部町": {
                        spots: ["美ら海水族館", "備瀬のフクギ並木", "エメラルドビーチ", "ゴリラチョップ"]
                    },
                    "恩納村": {
                        spots: ["万座毛", "青の洞窟", "恩納村海浜公園", "真栄田岬"]
                    }
                }
            },
            "本島中部": {
                cities: {
                    "宜野湾市": {
                        spots: ["沖縄コンベンションセンター", "トロピカルビーチ", "宜野湾マリン支援センター"]
                    },
                    "北谷町": {
                        spots: ["美浜アメリカンビレッジ", "サンセットビーチ", "北谷公園"]
                    }
                }
            },
            "離島": {
                cities: {
                    "石垣市": {
                        spots: ["石垣島", "川平湾", "石垣やいま村", "石垣島鍾乳洞", "平久保崎灯台", "米原ビーチ"]
                    },
                    "宮古島市": {
                        spots: ["宮古島", "与那覇前浜ビーチ", "来間大橋", "東平安名崎", "伊良部大橋", "池間大橋"]
                    },
                    "竹富町": {
                        spots: ["竹富島", "西表島", "由布島", "波照間島", "小浜島", "鳩間島"]
                    },
                    "久米島町": {
                        spots: ["はての浜", "久米島", "ミーフガー", "イーフビーチ"]
                    }
                }
            }
        }
    }
};

// 訪問済みの場所を保存するオブジェクト
let visitedPlaces = {
    prefectures: {},
    regions: {},
    cities: {},
    spots: {}
};

// ローカルストレージからデータを読み込む
function loadVisitedPlaces() {
    const savedData = localStorage.getItem('japanMapVisitedPlaces');
    if (savedData) {
        visitedPlaces = JSON.parse(savedData);
    }
}

// ローカルストレージにデータを保存する
function saveVisitedPlaces() {
    localStorage.setItem('japanMapVisitedPlaces', JSON.stringify(visitedPlaces));
}

// 訪問履歴をリセットする
function resetVisitedPlaces() {
    // 訪問データをクリア
    visitedPlaces = {
        prefectures: {},
        regions: {},
        cities: {},
        spots: {}
    };
    
    // ローカルストレージから削除
    localStorage.removeItem('japanMapVisitedPlaces');
    
    // 統計を更新
    updateStatistics();
    
    // 地図を更新
    updateMapColors();
    
    // 推奨を更新
    updateRecommendations();
    
    // セレクトボックスをリセット
    resetSelectors();
}

// 場所を訪問済みとしてマークする
function markAsVisited(prefectureName, regionName, cityName, spotName) {
    const visitDate = new Date().toISOString();
    
    // 都道府県レベル
    if (!visitedPlaces.prefectures[prefectureName]) {
        visitedPlaces.prefectures[prefectureName] = {
            visited: true,
            count: 0,
            date: visitDate
        };
    }
    
    // 地域レベル
    const regionKey = `${prefectureName}-${regionName}`;
    if (!visitedPlaces.regions[regionKey]) {
        visitedPlaces.regions[regionKey] = {
            visited: true,
            count: 0,
            date: visitDate
        };
    }
    
    // 市区町村レベル
    const cityKey = `${prefectureName}-${regionName}-${cityName}`;
    if (!visitedPlaces.cities[cityKey]) {
        visitedPlaces.cities[cityKey] = {
            visited: true,
            count: 0,
            date: visitDate
        };
    }
    
    // 観光スポットレベル
    const spotKey = `${prefectureName}-${regionName}-${cityName}-${spotName}`;
    if (!visitedPlaces.spots[spotKey]) {
        visitedPlaces.spots[spotKey] = {
            visited: true,
            date: visitDate
        };
        
        // カウントを増やす
        visitedPlaces.prefectures[prefectureName].count++;
        visitedPlaces.regions[regionKey].count++;
        visitedPlaces.cities[cityKey].count++;
    }
    
    // データを保存
    saveVisitedPlaces();
    
    // 統計を更新
    updateStatistics();
    
    // 地図を更新
    updateMapColors();
    
    // 推奨を更新
    updateRecommendations();
}

// 訪問履歴から場所を削除する
function removeVisitedPlace(type, key) {
    if (!visitedPlaces[type][key]) return;
    
    // 観光スポットの場合は、関連するカウントも減らす
    if (type === 'spots') {
        const parts = key.split('-');
        const prefectureName = parts[0];
        const regionName = parts[1];
        const cityName = parts[2];
        
        const regionKey = `${prefectureName}-${regionName}`;
        const cityKey = `${prefectureName}-${regionName}-${cityName}`;
        
        // カウントを減らす
        if (visitedPlaces.prefectures[prefectureName]) {
            visitedPlaces.prefectures[prefectureName].count--;
            
            // カウントが0になったら削除
            if (visitedPlaces.prefectures[prefectureName].count <= 0) {
                delete visitedPlaces.prefectures[prefectureName];
            }
        }
        
        if (visitedPlaces.regions[regionKey]) {
            visitedPlaces.regions[regionKey].count--;
            
            // カウントが0になったら削除
            if (visitedPlaces.regions[regionKey].count <= 0) {
                delete visitedPlaces.regions[regionKey];
            }
        }
        
        if (visitedPlaces.cities[cityKey]) {
            visitedPlaces.cities[cityKey].count--;
            
            // カウントが0になったら削除
            if (visitedPlaces.cities[cityKey].count <= 0) {
                delete visitedPlaces.cities[cityKey];
            }
        }
    }
    
    // 指定された場所を削除
    delete visitedPlaces[type][key];
    
    // データを保存
    saveVisitedPlaces();
    
    // 統計を更新
    updateStatistics();
    
    // 地図を更新
    updateMapColors();
    
    // 推奨を更新
    updateRecommendations();
    
    // 履歴リストを更新
    if (document.getElementById('history-container').classList.contains('hidden') === false) {
        updateHistoryList();
    }
}

// 訪問履歴リストを取得
function getVisitHistory(filterType = 'all', searchText = '') {
    const history = [];
    
    // 検索テキストを小文字に変換
    searchText = searchText.toLowerCase();
    
    // スポットの履歴のみを取得
    Object.keys(visitedPlaces.spots).forEach(key => {
        const parts = key.split('-');
        const prefectureName = parts[0];
        const regionName = parts[1];
        const cityName = parts[2];
        const spotName = parts[3];
        
        const displayName = `${prefectureName} > ${regionName} > ${cityName} > ${spotName}`;
        
        // フィルタータイプでフィルタリング
        if (filterType !== 'all' && filterType !== 'spot') {
            return;
        }
        
        // 検索テキストでフィルタリング
        if (searchText && !displayName.toLowerCase().includes(searchText)) {
            return;
        }
        
        history.push({
            type: 'spot',
            key: key,
            displayName: displayName,
            date: visitedPlaces.spots[key].date || '不明'
        });
    });
    
    // 日付の新しい順にソート
    history.sort((a, b) => {
        if (a.date === '不明' && b.date === '不明') return 0;
        if (a.date === '不明') return 1;
        if (b.date === '不明') return -1;
        return new Date(b.date) - new Date(a.date);
    });
    
    return history;
}

// 日付を読みやすい形式に変換
function formatDate(dateString) {
    if (dateString === '不明') return '不明';
    
    const date = new Date(dateString);
    return date.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

// 場所が訪問済みかどうかをチェック
function isVisited(type, key) {
    return visitedPlaces[type][key] && visitedPlaces[type][key].visited;
}

// 都道府県の訪問レベルを取得（0-5）
function getPrefectureVisitLevel(prefectureName) {
    if (!visitedPlaces.prefectures[prefectureName]) {
        return 0;
    }
    
    const prefecture = japanData[prefectureName];
    let totalSpots = 0;
    let visitedSpots = visitedPlaces.prefectures[prefectureName].count || 0;
    
    // 都道府県内の全観光スポット数を計算
    Object.keys(prefecture.regions).forEach(regionName => {
        const region = prefecture.regions[regionName];
        Object.keys(region.cities).forEach(cityName => {
            const city = region.cities[cityName];
            totalSpots += city.spots.length;
        });
    });
    
    if (totalSpots === 0) return 0;
    
    // 訪問率に基づいてレベルを計算
    const visitRate = visitedSpots / totalSpots;
    if (visitRate === 0) return 0;
    if (visitRate <= 0.2) return 1;
    if (visitRate <= 0.4) return 2;
    if (visitRate <= 0.6) return 3;
    if (visitRate <= 0.8) return 4;
    return 5;
}

// 統計情報を更新
function updateStatistics() {
    const prefectureCount = Object.keys(visitedPlaces.prefectures).length;
    const regionCount = Object.keys(visitedPlaces.regions).length;
    const cityCount = Object.keys(visitedPlaces.cities).length;
    const spotCount = Object.keys(visitedPlaces.spots).length;
    
    // 合計数を計算
    let totalRegions = 0;
    let totalCities = 0;
    let totalSpots = 0;
    
    Object.keys(japanData).forEach(prefectureName => {
        const prefecture = japanData[prefectureName];
        totalRegions += Object.keys(prefecture.regions).length;
        
        Object.keys(prefecture.regions).forEach(regionName => {
            const region = prefecture.regions[regionName];
            totalCities += Object.keys(region.cities).length;
            
            Object.keys(region.cities).forEach(cityName => {
                const city = region.cities[cityName];
                totalSpots += city.spots.length;
            });
        });
    });
    
    // DOM要素を更新
    document.getElementById('prefecture-count').textContent = prefectureCount;
    document.getElementById('region-count').textContent = regionCount;
    document.getElementById('total-regions').textContent = totalRegions;
    document.getElementById('city-count').textContent = cityCount;
    document.getElementById('total-cities').textContent = totalCities;
    document.getElementById('spot-count').textContent = spotCount;
    document.getElementById('total-spots').textContent = totalSpots;
}

// 次の旅行先を推奨
function getRecommendations() {
    const recommendations = [];
    const visitedPrefectures = new Set(Object.keys(visitedPlaces.prefectures));
    
    // 訪問率の低い都道府県を見つける
    Object.keys(japanData).forEach(prefectureName => {
        const visitLevel = getPrefectureVisitLevel(prefectureName);
        
        // 未訪問または訪問率が低い都道府県
        if (visitLevel < 3) {
            const prefecture = japanData[prefectureName];
            
            // 各地域を確認
            Object.keys(prefecture.regions).forEach(regionName => {
                const regionKey = `${prefectureName}-${regionName}`;
                const region = prefecture.regions[regionName];
                
                // 未訪問の地域
                if (!visitedPlaces.regions[regionKey] || visitedPlaces.regions[regionKey].count === 0) {
                    // 推奨に追加
                    recommendations.push({
                        prefecture: prefectureName,
                        region: regionName,
                        level: 'region',
                        density: visitLevel
                    });
                } else {
                    // 各市区町村を確認
                    Object.keys(region.cities).forEach(cityName => {
                        const cityKey = `${prefectureName}-${regionName}-${cityName}`;
                        const city = region.cities[cityName];
                        
                        // 未訪問の市区町村
                        if (!visitedPlaces.cities[cityKey] || visitedPlaces.cities[cityKey].count === 0) {
                            // 推奨に追加
                            recommendations.push({
                                prefecture: prefectureName,
                                region: regionName,
                                city: cityName,
                                level: 'city',
                                density: visitLevel
                            });
                        }
                    });
                }
            });
        }
    });
    
    // 密度（訪問率）の低い順にソート
    recommendations.sort((a, b) => a.density - b.density);
    
    return recommendations.slice(0, 5); // 上位5件を返す
}

// 推奨リストを更新
function updateRecommendations() {
    const recommendations = getRecommendations();
    const recommendationList = document.getElementById('recommendation-list');
    
    if (recommendations.length === 0) {
        recommendationList.innerHTML = '<p>まだ推奨する場所がありません。訪問した場所を登録してください。</p>';
        return;
    }
    
    let html = '';
    recommendations.forEach(rec => {
        if (rec.level === 'region') {
            html += `<div class="recommendation-item" data-prefecture="${rec.prefecture}" data-region="${rec.region}">
                ${rec.prefecture}の${rec.region}を訪れましょう
            </div>`;
        } else {
            html += `<div class="recommendation-item" data-prefecture="${rec.prefecture}" data-region="${rec.region}" data-city="${rec.city}">
                ${rec.prefecture}の${rec.region}にある${rec.city}を訪れましょう
            </div>`;
        }
    });
    
    recommendationList.innerHTML = html;
    
    // 推奨アイテムにクリックイベントを追加
    const items = document.querySelectorAll('.recommendation-item');
    items.forEach(item => {
        item.addEventListener('click', function() {
            const prefecture = this.dataset.prefecture;
            const region = this.dataset.region;
            const city = this.dataset.city;
            
            // セレクトボックスを更新
            const prefectureSelect = document.getElementById('prefecture-select');
            prefectureSelect.value = prefecture;
            prefectureSelect.dispatchEvent(new Event('change'));
            
            setTimeout(() => {
                const regionSelect = document.getElementById('region-select');
                regionSelect.value = region;
                regionSelect.dispatchEvent(new Event('change'));
                
                if (city) {
                    setTimeout(() => {
                        const citySelect = document.getElementById('city-select');
                        citySelect.value = city;
                        citySelect.dispatchEvent(new Event('change'));
                    }, 100);
                }
            }, 100);
        });
    });
}

// セレクトボックスをリセット
function resetSelectors() {
    const prefectureSelect = document.getElementById('prefecture-select');
    prefectureSelect.value = '';
    prefectureSelect.dispatchEvent(new Event('change'));
    
    const regionSelect = document.getElementById('region-select');
    regionSelect.value = '';
    regionSelect.dispatchEvent(new Event('change'));
    
    const citySelect = document.getElementById('city-select');
    citySelect.value = '';
    citySelect.dispatchEvent(new Event('change'));
}
